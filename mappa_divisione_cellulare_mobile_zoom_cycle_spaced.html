
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Divisione cellulare — Mappa interattiva (mobile + zoom, ciclo spazioso)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root{ --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --edge:#5b647a; --root:#1d4ed8; --macro:#f59e0b; --track:#16a34a; --fase:#0891b2; --mini:#334155; --note:#dc2626; }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:#e5e7eb; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    header{position:sticky; top:0; z-index:5; padding:12px 16px; background:#0b1220; border-bottom:1px solid #151f37}
    h1{margin:0; font-size:16px}
    #canvasWrap{height:calc(100vh - 56px); overflow:hidden; touch-action:none; position:relative}
    svg{width:100%; height:100%; background:#0f172a; border-top:1px solid #1f2a48}
    .node{cursor:pointer}
    .label{font-size:12px; fill:#e5e7eb; text-anchor:middle; pointer-events:none}
    .bubble{stroke:#ffffff22; stroke-width:1.5px}
    .g-root .bubble{fill:var(--root)}
    .g-macro .bubble{fill:var(--macro)}
    .g-track .bubble{fill:var(--track)}
    .g-fase .bubble{fill:var(--fase)}
    .g-mini .bubble{fill:var(--mini)}
    .g-note .bubble{fill:var(--note)}
    .edge{stroke:var(--edge); stroke-width:2; fill:none; marker-end:url(#arrow)}
    #sheet{position:fixed; left:0; right:0; bottom:0; z-index:9; background:var(--card); border-top:1px solid #1f2a48; border-radius:16px 16px 0 0; max-height:70vh; transform:translateY(100%); transition:transform .25s ease-out;}
    #sheet.open{transform:translateY(0)}
    #sheetHandle{width:46px; height:6px; background:#334155; border-radius:999px; margin:8px auto}
    #sheetBody{padding:10px 14px; overflow:auto; max-height:64vh}
    #sheetBody h2{margin:6px 0 8px 0; font-size:16px}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#0b2a26; color:#7ce2ca; border:1px solid #145e56}
    /* Zoom controls */
    #zoomCtrls{position:absolute; right:10px; top:10px; z-index:8; display:flex; flex-direction:column; gap:8px}
    .btn{background:#111827cc; backdrop-filter: blur(4px); color:#fff; border:1px solid #374151; border-radius:10px; width:42px; height:42px; font-size:20px; display:grid; place-items:center; user-select:none}
    .btn:active{transform:scale(0.98)}
  </style>
</head>
<body>
  <header><h1>Divisione cellulare — mappa (mobile + zoom) • ciclo sistemato</h1></header>
  <div id="canvasWrap">
    <div id="zoomCtrls">
      <div class="btn" id="zoomIn">+</div>
      <div class="btn" id="zoomOut">−</div>
      <div class="btn" id="zoomFit">⤢</div>
    </div>
    <svg id="map" viewBox="0 0 1400 2000" preserveAspectRatio="xMidYMid slice">
      <defs>
        <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L10,3 L0,6 z" fill="var(--edge)"></path>
        </marker>
      </defs>
      <g id="viewport"></g>
    </svg>
  </div>

  <div id="sheet">
    <div id="sheetHandle"></div>
    <div id="sheetBody"></div>
  </div>

<script>
// ---------- DATA (nuovo layout) ----------
// Spaziatura verticale maggiore per le catene; ciclo a cerchio ampio
const nodes = [
  ["root","Divisione cellulare","root", 180,120],
  ["proc","Procarioti","macro", 180,300],
  ["sciss","Scissione binaria","fase", 180,430],
  ["euca","Eucarioti","macro", 520,120],
  ["crom","Cromosoma eucariotico","macro", 900,120],
  ["ist","Istoni → nucleosomi","mini", 900,220],
  ["num","Numero cromosomi","mini", 900,300],

  // Ciclo cellulare: centro e quattro nodi a raggio ampio
  ["ciclo","Ciclo cellulare","macro", 520,320],
  ["g1","G1","fase", 520,520],   // sotto
  ["s","S","fase", 720,320],     // destra
  ["g2","G2","fase", 520,120],   // sopra
  ["fm","Fase M","fase", 320,320], // sinistra

  // Mitosi catena (spaziata)
  ["mit","Mitosi","track", 520,720],
  ["pro","Profase","fase", 520,840],
  ["meta","Metafase","fase", 520,960],
  ["ana","Anafase","fase", 520,1080],
  ["telo","Telofase","fase", 520,1200],
  ["cito","Citodieresi","fase", 520,1320],

  ["asex","Riproduzione asessuata","macro", 260,1320],
  ["scisA","Scissione","mini", 120,1410],
  ["gem","Gemmazione","mini", 260,1410],
  ["spor","Sporulazione","mini", 400,1410],
  ["rige","Rigenerazione","mini", 260,1500],

  // Meiosi catena (spaziata)
  ["mei","Meiosi","track", 900,720],
  ["mei1","Meiosi I","track", 900,840],
  ["p1","Profase I","fase", 900,960],
  ["m1","Metafase I","fase", 900,1080],
  ["a1","Anafase I","fase", 900,1200],
  ["t1","Telofase I","fase", 900,1320],
  ["mei2","Meiosi II","track", 900,1440],
  ["p2","Profase II","fase", 900,1560],
  ["m2","Metafase II","fase", 900,1680],
  ["a2","Anafase II","fase", 900,1800],
  ["t2","Telofase II","fase", 900,1920],
  ["xo","Crossing-over","note", 1080,960],

  // Sessuata a valle della meiosi
  ["sex","Riproduzione sessuata","macro", 1120,1440],
  ["gam","Gameti (n)","mini", 1120,1560],
  ["fec","Fecondazione","mini", 1120,1680],
  ["zig","Zigote (2n)","mini", 1120,1800],
  ["var","Variabilità genetica","mini", 1120,1920]
];

const edges = [
  ["root","proc"],["proc","sciss"],["root","euca"],
  ["euca","crom"],["crom","ist"],["crom","num"],
  ["euca","ciclo"],
  // ciclo ad anello largo
  ["ciclo","g1"],["g1","s"],["s","g2"],["g2","fm"],["fm","g1"],
  // mitosi
  ["euca","mit"],["mit","pro"],["pro","meta"],["meta","ana"],["ana","telo"],["telo","cito"],
  ["mit","asex"],["asex","scisA"],["asex","gem"],["asex","spor"],["asex","rige"],
  // meiosi catena
  ["euca","mei"],["mei","mei1"],["mei1","p1"],["p1","m1"],["m1","a1"],["a1","t1"],["t1","mei2"],
  ["mei2","p2"],["p2","m2"],["m2","a2"],["a2","t2"],
  ["p1","xo"],
  // sessuata a valle
  ["mei","sex"],["t2","gam"],["sex","gam"],["gam","fec"],["fec","zig"],["zig","var"]
];

const info = {
  root:{t:"Divisione cellulare", h:"Processo che genera cellule figlie trasmettendo il DNA."},
  proc:{t:"Procarioti", h:"Unico cromosoma circolare. Divisione per scissione binaria."},
  sciss:{t:"Scissione binaria", h:"Replica del DNA → invaginazione della membrana → parete si forma tra i due cromosomi → 2 cellule figlie identiche. Rapida, tipica di batteri."},
  euca:{t:"Eucarioti", h:"Nucleo e cromosomi lineari. Vie: mitosi (accrescimento/rinnovo) e meiosi (gameti)."},
  ciclo:{t:"Ciclo cellulare", h:"Anello: <b>G1 → S → G2 → M → G1</b>. Interfase = G1+S+G2; M = mitosi + citodieresi. Controlli con cicline/Cdk."},
  g1:{t:"G1", h:"Crescita e biosintesi; controllo danni al DNA pre-replica."},
  s:{t:"Fase S", h:"Replicazione del DNA; ogni cromosoma passa a due cromatidi fratelli."},
  g2:{t:"G2", h:"Riparazioni e preparazione alla mitosi; checkpoint G2/M."},
  fm:{t:"Fase M", h:"Mitosi + citodieresi; al termine si torna a G1."},
  crom:{t:"Cromosoma eucariotico", h:"DNA + proteine (cromatina). Istoni → nucleosomi → fibre → cromosomi. Numero specie-specifico."},
  ist:{t:"Istoni / nucleosomi", h:"Perni proteici attorno a cui si avvolge il DNA; base della compattazione."},
  num:{t:"Numero di cromosomi", h:"Somatiche 2n; gameti n."},
  mit:{t:"Mitosi", h:"Da 1 cellula (2n) a 2 cellule (2n) geneticamente identiche."},
  pro:{t:"Profase (mitosi)", h:"Condensazione cromatina; formazione del fuso; dissoluzione dell'involucro nucleare."},
  meta:{t:"Metafase (mitosi)", h:"Cromosomi allineati alla piastra metafasica; checkpoint del fuso."},
  ana:{t:"Anafase (mitosi)", h:"Segregazione dei cromatidi fratelli ai poli opposti."},
  telo:{t:"Telofase (mitosi)", h:"Riformazione dei nuclei; decondensazione del DNA."},
  cito:{t:"Citodieresi", h:"Divisione del citoplasma (solco di clivaggio o piastra cellulare)."},
  asex:{t:"Riproduzione asessuata", h:"Prole clonica (salvo mutazioni). Strategia rapida in ambienti stabili."},
  scisA:{t:"Scissione (asessuata)", h:"La cellula madre si divide in due parti uguali (es. protozoi)."},
  gem:{t:"Gemmazione", h:"Si forma una <b>gemma</b> sulla cellula/organismo madre che cresce e poi si stacca formando un individuo. Esempi: <i>Saccharomyces cerevisiae</i> (lievito), idra."},
  spor:{t:"Sporulazione (spore)", h:"Produzione di <b>spore</b> resistenti. Nei <b>funghi</b>: sporangiospore o conidiospore diffuse dall'aria; germinano in condizioni favorevoli. Anche batteri formano endospore (resistenti) come strategia di sopravvivenza."},
  rige:{t:"Rigenerazione", h:"Capacità di ricrescita di parti (planarie, stelle marine; in piante: taleaggio). Può contribuire alla riproduzione asessuata in alcuni taxa."},
  mei:{t:"Meiosi", h:"Due divisioni → 4 cellule aploidi geneticamente diverse."},
  mei1:{t:"Meiosi I (riduzionale)", h:"Separazione dei cromosomi omologhi; riduzione 2n→n."},
  p1:{t:"Profase I", h:"Appaiamento degli omologhi (tetradi); <b>crossing-over</b> e chiasmi."},
  m1:{t:"Metafase I", h:"Allineamento delle coppie omologhe al centro (assortimento indipendente)."},
  a1:{t:"Anafase I", h:"Separazione dei cromosomi omologhi (cromatidi ancora uniti)."},
  t1:{t:"Telofase I", h:"Formazione di 2 cellule aploidi."},
  mei2:{t:"Meiosi II (equazionale)", h:"Simile alla mitosi: separa i cromatidi fratelli."},
  p2:{t:"Profase II", h:"Riorganizzazione del fuso."},
  m2:{t:"Metafase II", h:"Allineamento dei cromosomi al centro."},
  a2:{t:"Anafase II", h:"Separazione dei cromatidi fratelli."},
  t2:{t:"Telofase II", h:"Risultato: 4 cellule aploidi diverse."},
  xo:{t:"Crossing-over", h:"Scambio reciproco tra cromatidi non fratelli: genera nuove combinazioni alleliche."},
  sex:{t:"Riproduzione sessuata", h:"Gameti (n) → fecondazione → zigote (2n). Aumenta variabilità genetica."},
  gam:{t:"Gameti (n)", h:"Spermatozoi, ovociti; prodotti per meiosi."},
  fec:{t:"Fecondazione", h:"Fusione dei gameti; ripristino del numero diploide."},
  zig:{t:"Zigote (2n)", h:"Prima cellula della nuova generazione; avvia lo sviluppo."},
  var:{t:"Variabilità genetica", h:"Deriva da crossing-over e assortimento indipendente."}
};

// ---------- RENDER SVG ----------
const svg = document.getElementById('map');
const vp = document.getElementById('viewport');

function pathBetween(a,b){
  const [ax,ay]=a,[bx,by]=b;
  const dx=bx-ax, dy=by-ay;
  const cx=ax+dx*0.5, cy=ay+dy*0.5-60; // curva un po' più ampia
  return `M${ax},${ay} Q${cx},${cy} ${bx},${by}`;
}
function getPos(id){
  const n = nodes.find(n=>n[0]===id); return [n[3],n[4]];
}
// draw edges
edges.forEach(([from,to])=>{
  const p = document.createElementNS("http://www.w3.org/2000/svg","path");
  p.setAttribute("d", pathBetween(getPos(from), getPos(to)));
  p.setAttribute("class","edge");
  p.setAttribute("marker-end","url(#arrow)");
  vp.appendChild(p);
});
// draw nodes
nodes.forEach(([id,label,group,x,y])=>{
  const g = document.createElementNS("http://www.w3.org/2000/svg","g");
  g.setAttribute("class",`node g-${group}`);
  g.setAttribute("transform",`translate(${x},${y})`);
  g.dataset.id = id;

  const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
  c.setAttribute("r", 36);
  c.setAttribute("class","bubble");
  c.setAttribute("cx",0); c.setAttribute("cy",0);
  g.appendChild(c);

  const t = document.createElementNS("http://www.w3.org/2000/svg","text");
  t.setAttribute("class","label"); t.setAttribute("x",0); t.setAttribute("y",4);
  t.textContent = label;
  g.appendChild(t);

  g.addEventListener('click', ()=> openCard(id));
  vp.appendChild(g);
});

// ---------- BOTTOM SHEET ----------
const sheet = document.getElementById('sheet');
function openCard(id){
  const x = info[id]; if(!x) return;
  document.getElementById('sheetBody').innerHTML = `<h2>${x.t} <span class='badge'>ripasso</span></h2><p>${x.h}</p>`;
  sheet.classList.add('open');
}
document.getElementById('sheetHandle').addEventListener('click', ()=>{
  sheet.classList.toggle('open');
});
openCard('ciclo');

// ---------- PAN & ZOOM (pinch, wheel, drag) ----------
let scale = 1, minScale = 0.6, maxScale = 2.5;
let panX = 0, panY = 0;
let dragging = false, lastX = 0, lastY = 0;
let touchMode = false, lastDist = 0, lastCenter = null;
const bbox = { x: 0, y: 0, w: 1400, h: 2000 };

function applyTransform(){
  vp.setAttribute('transform', `translate(${panX},${panY}) scale(${scale})`);
}
function clientToSvg(x,y){
  const pt = svg.createSVGPoint();
  pt.x = x; pt.y = y;
  const m = svg.getScreenCTM().inverse();
  const p = pt.matrixTransform(m);
  return { x: (p.x - panX)/scale, y: (p.y - panY)/scale };
}
function zoomAt(factor, clientX, clientY){
  const before = clientToSvg(clientX, clientY);
  scale = Math.min(maxScale, Math.max(minScale, scale * factor));
  const after = clientToSvg(clientX, clientY);
  panX += (after.x - before.x) * scale;
  panY += (after.y - before.y) * scale;
  applyTransform();
}
function fitView(){
  const rect = svg.getBoundingClientRect();
  const margin = 60;
  const sx = (rect.width - margin*2) / bbox.w;
  const sy = (rect.height - margin*2) / bbox.h;
  scale = Math.min(maxScale, Math.max(minScale, Math.min(sx, sy)));
  panX = (rect.width/2) - (bbox.w*scale/2);
  panY = (rect.height/2) - (bbox.h*scale/2);
  applyTransform();
}
fitView();

svg.addEventListener('wheel', (e)=>{
  e.preventDefault();
  const factor = e.deltaY < 0 ? 1.1 : 0.9;
  zoomAt(factor, e.clientX, e.clientY);
}, {passive:false});

svg.addEventListener('mousedown', (e)=>{ dragging=true; lastX=e.clientX; lastY=e.clientY; });
window.addEventListener('mousemove', (e)=>{
  if(!dragging) return;
  panX += (e.clientX-lastX); panY += (e.clientY-lastY);
  lastX=e.clientX; lastY=e.clientY; applyTransform();
});
window.addEventListener('mouseup', ()=> dragging=false);

svg.addEventListener('touchstart', (e)=>{
  if(e.touches.length===1){
    dragging=true; touchMode=false;
    lastX=e.touches[0].clientX; lastY=e.touches[0].clientY;
  }else if(e.touches.length===2){
    dragging=false; touchMode=true;
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    lastDist = Math.hypot(dx,dy);
    lastCenter = {
      x: (e.touches[0].clientX + e.touches[1].clientX)/2,
      y: (e.touches[0].clientY + e.touches[1].clientY)/2
    };
  }
},{passive:false});
svg.addEventListener('touchmove', (e)=>{
  e.preventDefault();
  if(touchMode && e.touches.length===2){
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.hypot(dx,dy);
    const factor = dist / lastDist;
    zoomAt(factor, lastCenter.x, lastCenter.y);
    lastDist = dist;
  }else if(dragging && e.touches.length===1){
    const x=e.touches[0].clientX, y=e.touches[0].clientY;
    panX += (x-lastX); panY += (y-lastY);
    lastX=x; lastY=y; applyTransform();
  }
},{passive:false});
svg.addEventListener('touchend', ()=>{ dragging=false; touchMode=false; });

document.getElementById('zoomIn').onclick = ()=> zoomAt(1.15, window.innerWidth/2, window.innerHeight/2);
document.getElementById('zoomOut').onclick = ()=> zoomAt(0.87, window.innerWidth/2, window.innerHeight/2);
document.getElementById('zoomFit').onclick = ()=> fitView();
</script>
</body>
</html>
